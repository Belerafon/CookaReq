
0. Назначение

Локальное Windows-приложение на wxPython для ведения требований, хранящихся как отдельные JSON-файлы в одной общей папке.
Пользователь создаёт/редактирует карточки требований через GUI, приложение сохраняет JSON на диск. Git-операции пользователь делает сам вне приложения.


---

1. Файловая модель

1.1. Расположение и структура

/requirements/          # ОДНА общая папка со всеми требованиями
/attachments/           # общий каталог вложений (не обязателен, но предлагается по умолчанию)

Все требования лежат в куче в /requirements/ (без подпапок).

Вложения — в /attachments/ (можно хранить и вне его, но путь сохраняется относительный к корню репозитория).


1.2. Имена файлов требований

Имя — хэш (строка в hex, без расширенной семантики), например:
a3f9c1d2e4b7.json

Хэш вычисляется детерминированно от поля id (алгоритм: SHA-256 → берём первые 12–16 hex символов).
Это даёт:

стабильное имя файла при неизменном id;

отсутствие коллизий и утечек содержания в имени;

предсказуемость при резервном копировании.


id после первого сохранения нельзя менять (поле только для чтения).


1.3. Формат JSON (один файл = одно требование)

Минимальный набор полей (можно расширять в будущем без миграций):

{
  "id": "REQ-0001",
  "title": "Время старта ≤ 5 с",
  "statement": "Система должна запускаться из состояния выключено за ≤ 5 с при T=+25°C.",
  "type": "requirement",                  // хранится кодом, в GUI по-русски
  "status": "draft",                      // draft|in_review|approved|baselined|retired
  "owner": "ivanov",
  "priority": "medium",                   // low|medium|high
  "source": "Контракт A-12, п.4.1",
  "verification": "test",                 // inspection|analysis|demonstration|test
  "acceptance": "TST-045: t_start ≤ 5 с при T=+25°C",
  "units": { "quantity": "s", "nominal": 5, "tolerance": null },
  "labels": ["software", "safety"],       // метки для фильтра/поиска
  "attachments": [
    { "path": "attachments/startup_scope.png", "note": "Осциллограмма старта" }
  ],
  "revision": 1,
  "approved_at": null,
  "notes": ""
}

1.4. Правила и ограничения

Уникальность id в пределах открытой папки — обязательна.

Допустимые значения, хранимые кодами (локализация в GUI):

type: requirement, constraint, interface

status: draft, in_review, approved, baselined, retired

priority: low, medium, high

verification: inspection, analysis, demonstration, test


labels — свободные метки, но в интерфейсе будут быстрые «чипы» для:
software / hardware / safety (можно добавлять свои).

Если verification = test или demonstration, поле acceptance обязательно.

Проверка ссылок ID временно отключена (полей links нет в UI и не валидируются).



---

2. Пользовательские сценарии

1. Открыть папку требований (/requirements/) — увидеть список всех JSON.


2. Создать требование — приложение спросит id, остальное по форме; файл запишется с хэш-именем.


3. Клонировать требование — с автоподстановкой нового id.


4. Редактировать — открыть из списка, править поля, сохранить.


5. Удалить — удалить файл (с подтверждением).


6. Прикрепить вложение — выбрать существующий файл из /attachments/ или выбрать файл с диска и (опционально) скопировать в /attachments/.


7. Поиск/фильтр — в памяти, без БД:

фильтр по меткам (мультивыбор «чипами»),

текстовый запрос (регистр игнорируется),

выбор полей, где искать (галочки: Заголовок, Текст требования, Критерий приёмки, Источник, Владелец, Заметки).



8. Разрешение конфликтов — пользователь решает в Git; приложение предупредит, если файл изменился на диске.




---

3. Интерфейс (wxPython)

3.1. Главное окно

Стартует большим, по центру экрана, пользователь может растягивать.

Структура: лево — список, право — редактор (разделитель можно двигать).

Верхняя панель: кнопки Открыть папку, Пересканировать, Создать, Клонировать, Удалить, Сохранить.


3.2. Левая панель «Список + фильтр»

Поле выбора папки (путь) и кнопка «Открыть папку».

Фильтр меток: набор «чипов»-переключателей:
Софт (software), Железо (hardware), Безопасность (safety) + «Добавить метку…».

Текстовый поиск + «Где искать» (чекбоксы полей):
Заголовок, Текст требования, Критерий приёмки, Источник, Владелец, Заметки.

Список требований (таблица):

Колонки: ID, Заголовок, Тип, Статус, Владелец, Метки, ! (есть ошибки).

Сортировка по клику на заголовок.

Двойной клик — открыть в редакторе.



3.3. Правая панель «Редактор требования»

Одна форма (без JSON-редактора), сгруппирована блоками:

Идентификация и статус

ID — текст, только для чтения после первого сохранения; кнопка «Скопировать».

Тип — выпадающий список (показываем по-русски: Требование, Ограничение, Интерфейс).

Статус — выпадающий список: Черновик, На рецензии, Согласовано, Зафиксировано, Снято с применения.

Приоритет — Низкий / Средний / Высокий.

Владелец — текст.

Источник — текст.


Содержание

Заголовок — однострочное поле.

Текст требования — многострочное поле (удобное для ввода).

Метод проверки — Инспекция / Анализ / Демонстрация / Испытание.

Критерий приёмки — многострочное поле (обязательно для Демонстрации/Испытания).


Единицы (необязательно)

Величина (единица), Номинал (число), Допуск (строка/число).


Метки

Список меток (чипы). Можно добавлять/удалять произвольные метки.
Быстрые кнопки: Софт, Железо, Безопасность.


Вложения

Таблица вложений: Файл (относительный путь) / Комментарий.

Кнопки:

Прикрепить… — диалог с двумя режимами:

1. Выбрать из существующих (покажем список файлов в /attachments/),


2. Выбрать на диске с флажком «скопировать в /attachments».
При копировании — авторазрешение коллизий имён (name(1).ext, name(2).ext).



Открыть, Показать в проводнике, Удалить (удаляет только запись; физический файл не трогаем).



Прочее

Номер ревизии (число, можно увеличить вручную).

Дата согласования (необязательно).

Заметки (многострочное поле).


Панель внизу формы — список ошибок/предупреждений валидации в реальном времени.


---

4. Поиск и фильтрация (в памяти)

Фильтрация применяется на лету к уже загруженному списку файлов (без БД и кэшей).

Метки: логика И/ИЛИ — по умолчанию ИЛИ (показывать требования, у которых есть хотя бы одна выбранная метка); переключатель в UI «Совпадать со всеми выбранными метками (И)».

Текстовый поиск: нечувствительный к регистру, простое вхождение подстроки.

Области поиска выбираются галочками (см. §3.2). По умолчанию: Заголовок + Текст требования.

Счётчик результатов и сброс фильтров одной кнопкой.



---

5. Валидация

5.1. Схемная (вшитая JSON Schema)

Обязательные поля: id, title, statement, type, status, verification.

Типы и диапазоны (число/строка/массив).

Допустимые коды для type/status/priority/verification.


5.2. Бизнес-правила

Уникальность id во всей открытой папке.

Если verification ∈ {test, demonstration} → acceptance обязателен.

attachments[].path — относительный путь (предупреждение, если абсолютный).

Проверки ссылок ID — отключены (не выполняются).


Ошибки подсвечивают соответствующие поля и отмечаются иконкой «!» в списке.


---

6. Работа с файлами и конфликтами

При открытии папки приложение рекурсивно НЕ ходит, оно читает только *.json в указанной папке /requirements/.

При сохранении:

JSON форматируется (2 пробела, предсказуемый порядок ключей).

Имя файла — из хэша от id (если это новый объект) или прежнее (если уже существует).


Контроль внешних изменений:

хранится mtime загруженного файла;

если перед сохранением mtime изменился → диалог:

Переоткрыть с диска (отменить несохранённые),

Перезаписать (сохранить поверх),

Сохранить как новый (сгенерировать новый хэш-файл).



Удаление — только файла требования; вложения физически не удаляются.



---

7. Локализация (отображение ↔ хранение)

В JSON — коды, в GUI — русские надписи:

Поле (код)	Отображение (RU)

type.requirement	Требование
type.constraint	Ограничение
type.interface	Интерфейс
status.draft	Черновик
status.in_review	На рецензии
status.approved	Согласовано
status.baselined	Зафиксировано
status.retired	Снято с применения
priority.low	Низкий
priority.medium	Средний
priority.high	Высокий
verification.inspection	Инспекция
verification.analysis	Анализ
verification.demonstration	Демонстрация
verification.test	Испытание


Метки (labels) показываем «как есть», без словаря; для быстрых кнопок: Софт→software, Железо→hardware, Безопасность→safety.


---

8. Нефункциональные требования

OS: Windows 10/11 x64.

Стек: Python 3.12 + wxPython; сборка PyInstaller (one-folder).

Производительность: до ~10 000 JSON-файлов — моментальный фильтр/поиск, загрузка списка по требованию.

Логи: %LOCALAPPDATA%\RequirementsEditor\app.log (ротация).

Кэш: отсутствует.

Интеграции: отсутствуют (ни Git, ни GitLab).

Безопасность: запись только в выбранные пользователем папки; никаких сетевых запросов.



---

9. Архитектура кода (укороченно)

/app
  main.py                 # запуск, главное окно
  ui/
    main_frame.py         # лейаут, меню/тулбар, фильтры
    list_panel.py         # список и фильтры/поиск (в памяти)
    editor_panel.py       # форма редактирования (блоки из §3.3)
  core/
    store.py              # чтение/запись JSON, генерация хэш-имен
    model.py              # модель Requirement (валидация типов/enum)
    schema.py             # JSON Schema и проверка
    validate.py           # бизнес-правила (уникальность id, acceptance и т.д.)
    search.py             # предикаты фильтра/поиска (без БД)
  util/
    hashing.py            # SHA-256 → короткий hex
    paths.py              # относительные пути, проверка attachments
    shell.py              # открыть файл/папку внешне


---

10. Горячие клавиши и UX-мелочи

Ctrl+O — выбрать папку, F5 — пересканировать, Ctrl+S — сохранить.

Delete — удалить выбранное требование в списке.

Формы «большие и удобные», элементы не «жмутся», окно — по центру при старте.

Негативные действия (Удалить/Перезаписать) — с подтверждением.



---

11. Критерии готовности (MVP)

1. Открытие одной папки с требованиями, отображение списка.


2. Создание/клонирование/редактирование/удаление требований.


3. Генерация имён файлов по хэшу от id; запрет изменения id после первого сохранения.


4. Рабочие метки (добавить/удалить) и их фильтр (чипы).


5. Поиск по выбранным полям, без БД (в памяти).


6. Вложения: выбор из существующих в /attachments/ или копирование выбранного файла в /attachments/; относительные пути в JSON.


7. Валидация: схема + правила (уникальность id, обязательность acceptance для нужных методов, относительные пути).


8. Обработка внешних изменений по mtime (диалог при сохранении).



