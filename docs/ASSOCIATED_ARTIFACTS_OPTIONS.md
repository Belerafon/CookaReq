# Минимальный подход: Markdown-папки и привязка к требованиям

Этот документ описывает самый простой универсальный способ добавлять к
требованиям связанные материалы (архитектура, обоснования, расчёты, заметки)
без дополнительных реестров и сложных сущностей.

## 1) Короткий ответ на вопрос по упрощению

Да, можно обойтись **без списка `documents`** и даже **без отдельной сущности
групп**.

Рабочий минимальный вариант:

- складывать Markdown-файлы в папку документа требований;
- в самом требовании хранить только ссылку на нужный Markdown-файл;
- экспорт собирать по этим ссылкам: сначала текст из файлов, потом сами
  требования.

## 2) Минимальная модель данных

Добавляется только одно поле в требование:

- `context_docs`: список относительных путей к Markdown-файлам.

Пример:

- `context_docs: ["related/math/overview.md", "related/math/limits.md"]`

Без дополнительных словарей и без метаданных в `document.json`.

## 3) Структура файлов

Рекомендуемая структура внутри конкретного документа:

- `requirements/<DOC>/related/...`

Примеры:

- `requirements/HLR/related/math/overview.md`
- `requirements/HLR/related/math/interfaces.md`
- `requirements/HLR/related/ui/navigation.md`

Правила:

- только относительные пути (никаких абсолютных);
- только `.md` на первом этапе;
- файл должен существовать в дереве текущего документа.

## 4) Как работает экспорт

Экспорт для выбранного набора требований:

1. Собрать все пути из `context_docs` у выбранных требований.
2. Удалить дубли путей, отсортировать их лексикографически.
3. Вставить содержимое Markdown-файлов в начало документа.
4. После этого вставить требования в обычном порядке экспорта.

Итоговый результат: сначала связанный контекст, затем требования.

## 5) Что это даёт

- Минимальная сложность модели.
- Почти нулевая стоимость внедрения в UI/CLI.
- Нет отдельной «базы» и проблем синхронизации метаданных.
- Можно использовать для любого типа инженерных материалов, если они в Markdown.

## 6) Ограничения упрощённого варианта

- Нет явного порядка документов кроме сортировки по пути.
- Нет типизации (`architecture`, `rationale`, `calculation`) на уровне схемы.
- Нет встроенных метаданных владельца, версии и статуса документа.
- Слабее контроль качества контента по сравнению с более формальной моделью.

Это осознанный компромисс ради простоты.

## 7) Обязательные валидации

Даже в минимальной схеме обязательно проверять:

- что путь из `context_docs` остаётся внутри `requirements/<DOC>/`;
- что файл существует;
- что расширение `.md`;
- что общий объём подключаемых Markdown-файлов не превышает разумный лимит
  экспорта.

## 8) Практический план внедрения

1. Добавить `context_docs` в модель требований.
2. Добавить валидацию путей при сохранении.
3. В редакторе требования добавить простой контрол «список Markdown-файлов».
4. В экспорте реализовать предблок из содержимого `context_docs`.
5. Добавить тесты:
   - валидация путей и расширений;
   - дедупликация и порядок вставки файлов;
   - экспорт «контекст до требований».

## 9) Когда переходить к более сложной схеме

Расширяться стоит только при реальной потребности:

- нужен ручной порядок документов, отличный от сортировки путей;
- нужны типы документов и шаблоны секций;
- нужны владельцы/статусы/ревизии контекстных материалов;
- нужно подключать не только Markdown.

Пока таких требований нет, вариант с `context_docs` — наиболее рациональный.
