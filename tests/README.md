# Тестовые наборы CookaReq

Этот каталог разделён на подкаталоги по типам проверок. Ключевые директории:

| Каталог | Назначение |
|---------|------------|
| `unit/` | Быстрые модульные и сервисные проверки. |
| `integration/` | Сборка CLI/MCP сценариев поверх файлового стора. |
| `gui/` | Регрессионные тесты wxWidgets интерфейса. |
| `smoke/` | Минимальный end-to-end сценарий запуска приложения. |
| `slow/` | Долгие сценарии, исключены из `core` по умолчанию. |

Отдельные модули вне подкаталогов (например `mcp_utils.py`) предоставляют вспомогательные фикстуры и утилиты для тестов.

## Логические тестовые наборы

Опция `pytest --suite <имя>` включает преднастроенные выборки тестов. Чтобы увидеть краткую справку, запустите:

```bash
pytest --list-suites
```

На момент изменения структуры результаты запуска выглядели так:

| Набор | Время | Когда запускать | Состав |
|-------|-------|-----------------|--------|
| `core` | ~1.5 мин | После локальных правок и перед PR. | Все модульные, smoke и другие быстрые проверки без GUI и "slow". |
| `service` | ~3 мин | Когда меняются CLI, MCP или хранилище документов. | `core` + интеграционные сценарии CLI/MCP. |
| `gui-smoke` | ~20 с (сейчас красный) | После правок UI/лейаутов для быстрой обратной связи. | Основные happy-path окна (`MainFrame`, `AgentChatPanel`, редактор). |
| `gui-full` | ~8 мин | Перед релизом или крупными UI-изменениями. | Полная регрессия GUI, включает exhaustively помеченные `gui_full`. |
| `real-llm` | ~2 мин + сеть | Перед релизом LLM-интеграций. | Минимальный прогон против живого OpenRouter (требует `OPEN_ROUTER`). |
| `quality` | ~1 мин | При изменениях i18n или инфраструктуры качества. | Статический анализ, линтеры и проверки переводов. |

При явном запуске `pytest --suite real-llm …` конфигурация автоматически ищет
`OPEN_ROUTER` в ближайшем `.env` и выставляет `COOKAREQ_RUN_REAL_LLM_TESTS=1`.
Отдельно экспортировать переменную или выполнять `source .env` больше не
нужно; вручную выставляйте флаг только при точечном запуске отдельных тестов
без логического набора.

> Докстринговая проверка в `quality` пока охватывает backend-модули (`app/core`, `app/util`, `app/mcp`, `app/cli`, а также
> ключевые вспомогательные компоненты UI). Остальные части интерфейса будут подтягиваться по мере документирования —
> добавляйте новые пути в `tests/slow/test_pydocstyle.py` по мере наведения порядка.

> ⚠️ `gui-smoke` сейчас падает (см. `pytest --suite gui-smoke -q`). Ошибки связаны с расхождениями API `AgentChatPanel`, `AgentBatchSection` и `DetachedEditorFrame`. Следует завести отдельные задачи на исправление, прежде чем полагаться на этот набор.

## Рекомендованный порядок запуска

1. `pytest -q` или `pytest --suite core -q` — быстрый локальный сигнал.
2. При правках CLI/MCP — `pytest --suite service -q`.
3. Для UI-изменений — сначала `pytest --suite gui-smoke -q`, затем при необходимости `pytest --suite gui-full -q` (или таргетированные файлы).
4. Перед релизом: `pytest --suite quality -q`, `pytest --suite real-llm -q` (с загруженными креденшелами).

Если нужно ограничиться одной подгруппой файлов, указывайте путь: `pytest --suite core tests/unit/test_agent_loop_runner.py -q`.

