# CookaReq

Приложение на wxPython для работы с требованиями, сохраняемыми в виде JSON-файлов.

## Версия Python

В репозитории используется системный Python 3.12.3. Файл `.python-version`
фиксирует `pyenv` на значении `system`, поэтому при входе в каталог команды
`python3` и `pip` указывают на нужный интерпретатор. Команда `python`
в контейнере отсутствует, используйте `python3`.

## Сборка

Для создания Windows-сборки используется PyInstaller. Важно собирать в том же окружении, где установлены все зависимости (wxPython и jsonschema), иначе в сборку не попадут нужные пакеты.

1) Подготовьте окружение

```bash
python3 -m venv .venv
.venv\\Scripts\\activate
pip install -r requirements.txt
pip install pyinstaller
```

2) Соберите приложение (режим one-folder по умолчанию)

```bash
python3 build.py
```

Готовые файлы появятся в каталоге `dist/CookaReq`. Этот вариант самодостаточный: папка содержит все нужные DLL/библиотеки.

3) Альтернатива: один файл (one-file)

```bash
python3 build.py --onefile
```

Будет создан один `CookaReq.exe`, который при запуске распаковывается во временную папку. Такой EXE также самодостаточный и не зависит от установленных модулей в системе.

Примечание: если при запуске EXE видите `ModuleNotFoundError: No module named 'wx'`, значит wxPython не был установлен в окружение, в котором выполнялся `build.py`. Убедитесь, что выполняли сборку из активированного venv с установленными зависимостями (см. шаг 1).

## Запуск тестов в контейнере

Чтобы прогонять тесты GUI без сборки wxPython из исходников,
установите готовые пакеты и зависимости из репозиториев Ubuntu:

```bash
apt-get update && apt-get install -y \
    python3-wxgtk4.0 python3-pip xvfb xauth
python3 -m venv .venv --system-site-packages
source .venv/bin/activate
pip install pytest pytest-xvfb jsonschema
pytest -q
```

`pytest-xvfb` автоматически поднимает виртуальный дисплей, поэтому
окна не появятся и тесты выполняются в headless-режиме.

## Локализация

Проект использует `gettext` и `wx.Locale`. В репозитории хранятся только исходные
`.po`‑файлы переводов. Скомпилированные каталоги `.mo` не добавляются в git и
генерируются локально.

1. Установите утилиты GNU gettext (необходима команда `msgfmt`). Например, в
   Ubuntu:

   ```bash
   sudo apt-get update && sudo apt-get install -y gettext
   ```

2. Скомпилируйте все переводы:

   ```bash
   python3 compile_translations.py
   ```

Скрипт сгенерирует `.mo`‑файлы рядом с соответствующими `.po`. При запуске
`build.py` компиляция выполняется автоматически, поэтому готовая сборка всегда
содержит актуальные переводы.
