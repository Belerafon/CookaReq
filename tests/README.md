# Тестовые наборы CookaReq

Этот каталог разделён на подкаталоги по типам проверок. Ключевые директории:

| Каталог | Назначение |
|---------|------------|
| `unit/` | Быстрые модульные и сервисные проверки. |
| `integration/` | Сборка CLI/MCP сценариев поверх файлового стора. |
| `gui/` | Регрессионные тесты wxWidgets интерфейса. |
| `smoke/` | Минимальный end-to-end сценарий запуска приложения. |
| `slow/` | Долгие сценарии, исключены из `core` по умолчанию. |

Отдельные модули вне подкаталогов (например `mcp_utils.py`) предоставляют вспомогательные фикстуры и утилиты для тестов.

## Логические тестовые наборы

Опция `pytest --suite <имя>` включает преднастроенные выборки тестов. Чтобы увидеть краткую справку, запустите:

```bash
pytest --list-suites
```

На момент изменения структуры результаты запуска выглядели так:

| Набор | Время | Когда запускать | Состав |
|-------|-------|-----------------|--------|
| `core` | ~1.5 мин | После локальных правок и перед PR. | Все модульные, smoke и другие быстрые проверки без GUI и "slow". |
| `gui-smoke` | ~6 с | После правок UI/лейаутов для быстрой обратной связи. | Тесты, помеченные `pytest.mark.gui_smoke`, охватывающие основные окна (`MainFrame`, `AgentChatPanel`, редактор). |
| `gui-full` | ~8 мин | Перед релизом или крупными UI-изменениями. | Полная регрессия GUI: все тесты, помеченные `pytest.mark.gui`. |
| `real-llm` | ~2 мин + сеть | Перед релизом LLM-интеграций. | Минимальный прогон против живого OpenRouter (требует `OPEN_ROUTER`). |
| `quality` | ~1 мин | При изменениях i18n или инфраструктуры качества. | Статический анализ, линтеры и проверки переводов. |

Интеграционные сценарии CLI/MCP остаются частью `core` (они не помечены `gui` и `slow`), поэтому отдельный набор `service` больше не требуется.

При явном запуске `pytest --suite real-llm …` конфигурация автоматически ищет
`OPEN_ROUTER` в ближайшем `.env` и выставляет `COOKAREQ_RUN_REAL_LLM_TESTS=1`.
Отдельно экспортировать переменную или выполнять `source .env` больше не
нужно; вручную выставляйте флаг только при точечном запуске отдельных тестов
без логического набора.

> Докстринговая проверка в `quality` пока охватывает backend-модули (`app/core`, `app/util`, `app/mcp`, `app/cli`, а также
> ключевые вспомогательные компоненты UI). Остальные части интерфейса будут подтягиваться по мере документирования —
> добавляйте новые пути в `tests/slow/test_pydocstyle.py` по мере наведения порядка.

> `gui-smoke` рассчитан на быстрый прогон 17 ключевых сценариев (MainFrame, редактор, AgentChatPanel, диалоги). Поддерживайте метки `pytest.mark.gui_smoke` только на действительно критичных тестах, чтобы набор оставался лёгким.

## Рекомендованный порядок запуска

1. `pytest -q` или `pytest --suite core -q` — быстрый локальный сигнал.
2. Для UI-изменений — сначала `pytest --suite gui-smoke -q`, затем при необходимости `pytest --suite gui-full -q` (или таргетированные файлы).
3. Перед релизом: `pytest --suite quality -q`, `pytest --suite real-llm -q` (с загруженными креденшелами).

Если нужно ограничиться одной подгруппой файлов, указывайте путь: `pytest --suite core tests/unit/test_agent_loop_runner.py -q`.

