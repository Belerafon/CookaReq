# –ü–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –∞–≥–µ–Ω—Ç—Å–∫–æ–≥–æ —Å—Ç–µ–∫–∞

## –õ–µ–≥–µ–Ω–¥–∞ —Å—Ç–∞—Ç—É—Å–æ–≤
- [x] ‚úîÔ∏è –í—ã–ø–æ–ª–Ω–µ–Ω–æ
- [~] üîÑ –í –ø—Ä–æ—Ü–µ—Å—Å–µ
- [ ] ‚òê –ù–µ –Ω–∞—á–∞—Ç–æ
- [!] ‚õî –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ

## –°–≤–æ–¥–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- –ë–∞–∑–æ–≤—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç –¥–∞–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç—Å–∫–æ–≥–æ –ø—Ä–æ–≥–æ–Ω–∞ –æ–ø–∏—Å–∞–Ω –≤ `app/agent/run_contract.py` –∏ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–µ–∑ —ç–≤—Ä–∏—Å—Ç–∏–∫. (‚úîÔ∏è)
- MCP-—Å–µ—Ä–≤–µ—Ä –∏ –∫–ª–∏–µ–Ω—Ç —É–º–µ—é—Ç –æ–±–º–µ–Ω–∏–≤–∞—Ç—å—Å—è —Å—Ö–µ–º–∞–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤, —á—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –æ—Ç–∫–∞–∑–∞—Ç—å—Å—è –æ—Ç –¥–æ–≥–∞–¥–æ–∫ –≤ UI. (‚úîÔ∏è)
- –õ–æ–∫–∞–ª—å–Ω—ã–π –∞–≥–µ–Ω—Ç –∏ UI —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ –Ω–æ–≤–æ–º –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ; –æ—Å—Ç–∞–ª–æ—Å—å –ø—Ä–æ–¥—É–º–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –∏—Å—Ç–æ—Ä–∏–π –∏ –æ–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é. (üîÑ)

## –î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è

### 1. –ö–æ–Ω—Ç—Ä–∞–∫—Ç –∏ —Å—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö
- [x] –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π `AgentRunPayload`, `ToolResultSnapshot`, LLM-—Ç—Ä–µ–π—Å –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏. ‚Üí `app/agent/run_contract.py`.
- [x] –†–∞—Å—à–∏—Ä–∏—Ç—å MCP-—Å–µ—Ä–≤–µ—Ä (`/mcp/schema`) –∏ –∫–ª–∏–µ–Ω—Ç, —á—Ç–æ–±—ã –ø—Ä–æ–∫–∏–¥—ã–≤–∞—Ç—å —Å—Ö–µ–º—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –±–µ–∑ –∑–Ω–∞–Ω–∏—è MCP –≤–Ω—É—Ç—Ä–∏ –∞–≥–µ–Ω—Ç–∞.
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç `AgentRunPayload` –∏ `tool_schemas` –≤ `docs/ARCHITECTURE.md` (–ø–æ—Å–ª–µ–¥–Ω–∏–π —à–∞–≥ –ø–æ—Å–ª–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏).

### 2. –°–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å –∞–≥–µ–Ω—Ç–∞
- [x] –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å `app/agent/local_agent.py` –≤–æ–∫—Ä—É–≥ `_AgentRunRecorder`, —á—Ç–æ–±—ã —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å `AgentRunPayload` –±–µ–∑ `_llm_steps` –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö —ç–≤—Ä–∏—Å—Ç–∏–∫.
- [x] –£–¥–∞–ª–∏—Ç—å –ª–µ–≥–∞—Å–∏-—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (`_llm_requests`, `StreamedToolResultState`, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–ª–æ–≤–∞—Ä–∏) –∏ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Å–Ω–∞–ø—à–æ—Ç—ã `ToolResultSnapshot`.
- [x] –í—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏–µ —Å—Ö–µ–º MCP –≤ `tool_schemas` —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –æ—à–∏–±–æ–∫ –ø–æ–ª—É—á–µ–Ω–∏—è.

### 3. –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –∏—Å—Ç–æ—Ä–∏—è
- [~] –û–±–Ω–æ–≤–∏—Ç—å `AgentRunController` –∏ `AgentRunHandle` –Ω–∞ —Ä–∞–±–æ—Ç—É —Å–æ —Å–Ω–∞–ø—à–æ—Ç–∞–º–∏/LLM-—Ç—Ä–µ–π—Å–æ–º –±–µ–∑ `looks_like_tool_payload` –∏ –ø—Ä–æ—á–∏—Ö —É–≥–∞–¥—ã–≤–∞–Ω–∏–π. ‚Ü¶ –∫–æ–ª–±—ç–∫–∏ —Ç–µ–ø–µ—Ä—å –ø–µ—Ä–µ–¥–∞—é—Ç `ToolResultSnapshot`, –ø–æ—Ç–æ–∫–æ–≤—ã–π —Å—Ç–æ—Ä –ø–æ–ª—É—á–∞–µ—Ç –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã; —Ö—Ä–∞–Ω–µ–Ω–∏–µ LLM-—Ç—Ä–µ–π—Å–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —Å –Ω–æ–≤—ã–º view-model.
- [x] –ü–µ—Ä–µ–¥–µ–ª–∞—Ç—å `history_utils` –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä—ã –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è `AgentRunPayload` –∫–∞–∫ —Ü–µ–ª–æ—Å—Ç–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞. ‚Ü¶ —É–±—Ä–∞–Ω—ã `normalise_tool_payloads`/`extract_tool_results`, –æ—Å—Ç–∞–ª–∏—Å—å —Ç–æ–ª—å–∫–æ `tool_snapshots_from` –∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞.
- [ ] –ü—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–ø–∏—Å–µ–π –∏—Å—Ç–æ—Ä–∏–∏ (–Ω–∞ —É—Ä–æ–≤–Ω–µ –∑–∞–≥—Ä—É–∑–∫–∏) –∏–ª–∏ —è–≤–Ω—É—é –æ—á–∏—Å—Ç–∫—É –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞.

- [x] –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å `panel` –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `AgentRunPayload` –∏ `ToolResultSnapshot` –±–µ–∑ –º–µ—Ä–¥–∂–∞ —Å–ª–æ–≤–∞—Ä–µ–π –∏ `_ensure_*`. ‚Ü¶ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è, –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –ø–æ—Ç–æ–∫–æ–≤—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ —Å–Ω–∞–ø—à–æ—Ç–∞—Ö.
- [x] –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å `tool_summaries` –∏ `view_model` –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `ToolResultSnapshot.events`, `metrics`, `llm_trace` –∏ –Ω–æ–≤—ã—Ö —Å—Ö–µ–º.
- [x] –£–ø—Ä–æ—Å—Ç–∏—Ç—å –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ç–∞–π–º–ª–∞–π–Ω–∞ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫, —É–±—Ä–∞–≤ —Ñ—É–Ω–∫—Ü–∏–∏ `_collect_llm_step_payloads`, `_merge_*`, `_extract_*` –∏ —Ç. –ø.
- [ ] –ê–∫—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—à–∏–±–æ–∫, –æ–ø–∏—Ä–∞—è—Å—å –Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (`ToolError`, `ToolMetrics`).

### 5. –¢–µ—Å—Ç—ã –∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è
- [x] –û–±–Ω–æ–≤–∏—Ç—å —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã (`tests/unit`), –≤–Ω–µ–¥—Ä–∏–≤ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª—è –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏—Å—Ç–æ—Ä–∏–∏. ‚Ü¶ –ø–µ—Ä–µ–ø–∏—Å–∞–Ω—ã —Ç–µ—Å—Ç—ã –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞, –ª–æ–≥-—ç–∫—Å–ø–æ—Ä—Ç–∞ –∏ view-model; –ø—Ä–æ–≥–æ–Ω `pytest --suite core -k agent_chat -q` –∑–µ–ª—ë–Ω—ã–π.
- [ ] –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å GUI-—Ç–µ—Å—Ç—ã, –æ—Å–æ–±–µ–Ω–Ω–æ `tests/gui/test_agent_chat_panel.py`, –∫ –Ω–æ–≤–æ–π –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö.
- [ ] –ü—Ä–æ–≥–Ω–∞—Ç—å `pytest --suite core -q` –∏ `pytest --suite gui-smoke -q` –∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.

### 6. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –∑–∞–∫–ª—é—á–∏—Ç–µ–ª—å–Ω—ã–µ —à–∞–≥–∏
- [x] –†–∞—Å—à–∏—Ä–∏—Ç—å `docs/ARCHITECTURE.md` –æ–ø–∏—Å–∞–Ω–∏–µ–º –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å MCP.
- [ ] –û—á–∏—Å—Ç–∏—Ç—å –∫–æ–¥–æ–≤—É—é –±–∞–∑—É –æ—Ç –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —É—Ç–∏–ª–∏—Ç –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä –ø–æ—Å–ª–µ –ø–µ—Ä–µ—Ö–æ–¥–∞.
- [ ] –ü—Ä–æ–≤–µ—Å—Ç–∏ –∏—Ç–æ–≥–æ–≤–æ–µ —Ä–µ–≤—å—é –ø–ª–∞–Ω–∞ –∏ –æ—Ç–º–µ—Ç–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —à–∞–≥–∏.

## –û—Ç–∫—Ä—ã—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∏ —Ä–∏—Å–∫–∏
- –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ—à–∏—Ç—å, –∫–∞–∫ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏–∏: –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–ª–∏ –æ—á–∏—Å—Ç–∫–∞. –†–µ—à–µ–Ω–∏–µ –Ω—É–∂–Ω–æ –¥–æ –Ω–∞—á–∞–ª–∞ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è `history_utils`.
- –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ –æ—Å—Ç–∞–ª–∏—Å—å –ª–∏ —Å–∫—Ä—ã—Ç—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–∞ —Å—Ç–∞—Ä—ã–µ –∫–ª—é—á–∏ `raw_result` –≤ –¥—Ä—É–≥–∏—Ö –ø–æ–¥—Å–∏—Å—Ç–µ–º–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ª–æ–≥–æ–≤).
- –ü–æ—Å–ª–µ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è –∞–≥–µ–Ω—Ç–∞ –≤–∞–∂–Ω–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤: –ø–æ—è–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –¥–æ–ª–≥–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ñ–∏–∫—Å—Ç—É—Ä.

